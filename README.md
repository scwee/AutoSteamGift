# AutoSteamGift
Plugin for FunpayCardinal

# 🎮 Auto Steam Gift Sender

> **Автоматическая отправка Steam гифтов через API ns.gifts для FunPayCardinal**

Плагин автоматизирует процесс продажи Steam игр на FunPay: запрашивает Steam профиль у покупателя, подтверждает его и отправляет гифт через API ns.gifts.

---

## ✨ Возможности

- ✅ **Автоматическая обработка заказов** FunPay
- 🔐 **Двухэтапное подтверждение** (ссылка → подтверждение)
- 🎮 **Поддержка регионов** RU, UA, KZ
- 📊 **Telegram панель управления**
- 💰 **Проверка баланса API** в реальном времени
- 📈 **Статистика заказов** (топ игр, выручка)
- 🔄 **Авторефунды** при ошибках
- 💾 **История заказов** с сохранением
- 🛠️ **Управление лотами** через 3 шага
- 🔍 **Валидация профилей** через regex

---

## 🚀 Быстрый старт

### Установка

1. Скопируйте `auto_steam_gifts.py` в папку `FunPayCardinal/plugins/`
2. Перезапустите Cardinal: `python main.py`
3. Откройте бот в Telegram: `/gift_steam`
4. Настройте API ключ ns.gifts
5. Добавьте лоты FunPay

**Готово!** Плагин работает автоматически ✅

---

## 📖 Как работает

Покупатель оплачивает → Плагин запрашивает Steam профиль
↓
Покупатель отправляет ссылку
↓
Плагин проверяет и просит "+"
↓
Покупатель подтверждает: "+"
↓
Плагин отправляет гифт через API
↓
✅ Успех! Гифт доставлен

---

## 🎛️ Telegram панель

### Команда: `/gift_steam`

🎮 Steam Gifts - Панель управления

API ключ: abc12345...xyz7
Настроено лотов: 3
Всего заказов: 127

┌─────────────────────────────────┐
│ [🔑 API ✅] [💰 Баланс] │
│ [🎮 Лоты (3)] [📊 Статистика] │
│ [💸 Авторефунды ✅] │
└─────────────────────────────────┘


### Функции кнопок:

| Кнопка | Описание |
|--------|----------|
| 🔑 API | Настройка токена ns.gifts |
| 💰 Баланс | Проверка остатка средств |
| 🎮 Лоты | Добавить/удалить лоты |
| 📊 Статистика | Топ-5 игр, выручка |
| 💸 Авторефунды | Вкл/выкл возвраты |

---

## 🔧 Настройка лотов

### Пример добавления:

**Шаг 1:** Введите ID лота → `123456`  
**Шаг 2:** Введите название → `Dead by Daylight`  
**Шаг 3:** Выберите регион → `🇷🇺 RU`

✅ **Лот добавлен!**

---

## 🔐 Поддерживаемые форматы Steam

✅ `https://steamcommunity.com/id/nickname`  
✅ `https://steamcommunity.com/profiles/76561198012345678`  
❌ `steamcommunity.com/nickname` (без https)  
❌ `nickname` (просто ник)

---

## 🛠️ API ns.gifts

**Проверка баланса:**

GET /api/v1/check_balance
Authorization: Bearer YOUR_TOKEN


**Отправка гифта:**

POST /api/v1/steam_gift/create_order
{
"friendLink": "...",
"region": "ru",
"giftName": "Dead by Daylight"
}

---

## 📊 Статистика

Плагин собирает:
- Всего заказов
- Общую выручку
- Топ-5 игр
- Историю транзакций

Данные в: `storage/steam_gifts/config.json`

---

## 🚨 Обработка ошибок

### Автоматические возвраты

Если включены **авторефунды**, плагин вернёт деньги при:
- ❌ Недостаточном балансе
- ❌ Ошибках API
- ❌ Недоступности сервиса

### Логи

Все события в консоли:

[SteamGifts] ✅ Gift sent: Dead by Daylight
[SteamGifts] ❌ Gift error: Insufficient balance
[SteamGifts] ⚠️ API key not configured


### Сообщения при ошибках | Оплата заказа | Успешная выдача

"templates": {
"start_message": "Спасибо за оплату!...",
"purchase_success": "✅ Гифт отправлен!...",
"purchase_error": "❌ Ошибка: {error}..."
}
}


---

## ❓ FAQ

**Q: Плагин не реагирует?**  
A: Добавьте ID лота в панели `/gift_steam`

**Q: Ошибка "API key not configured"?**  
A: Настройте ключ через кнопку 🔑 API

**Q: Покупатель отправил неверную ссылку?**  
A: Плагин автоматически запросит правильный формат

**Q: Как отменить отправку?**  
A: Покупатель отправляет `-` при подтверждении

**Q: Где история заказов?**  
A: Панель → 📊 Статистика или `config.json`

---

## 📂 Структура

FunPayCardinal/
├── plugins/
│ └── auto_steam_gifts.py
└── storage/
└── steam_gifts/
└── config.json








